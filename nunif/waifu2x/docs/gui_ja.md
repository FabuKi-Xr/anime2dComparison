# waifu2x-gui

waifu2x-guiは超解像ソフトウェアです。画像をいい感じに拡大します。

インストールについては[nunif windows package](../../windows_package/docs/README_ja.md)を参照してください。

![waifu2x-gui-ja](https://github.com/nagadomi/nunif/assets/287255/157058ba-6b3b-4627-ab80-2313fc873e6a)

## 入力

処理対象のファイルまたはフォルダを選択します。最初のボタンが`ファイル選択`で、次のボタンが`フォルダ選択`です。ファイルひとつの場合はドラッグアンドドップもできます。

フォルダを選択した場合はフォルダ直下の画像ファイルと動画ファイルが対象になります。

`処理を再開`にチェックをつけるとすでに出力が存在するファイルをスキップします。

`すべてのサブフォルダを処理`にチェックをつけると指定フォルダより下の階層にあるすべてのファイルが対象になります。ただし出力フォルダ内は除外されます。
指定したフォルダによっては非常に多くのファイルが対象になるので注意してください。

再生ボタンをクリックすると選択したファイルまたはフォルダが表示されます。

## 出力

出力フォルダを選択します。
入力がファイルの場合は出力ファイル名を直接入力することもできます。画像の場合は`.jpg, .png, webp`、動画の場合は`.mp4`の拡張子を使用してください。

`同じフォルダを設定`ボタンでは入力と同じフォルダの下に`waifu2x`フォルダを作ってそこに出力します。

再生ボタンをクリックすると出力結果があればそれを表示します。なければ出力フォルダを表示します。

## 超解像

超解像関連の設定です。

### モデル

使用するモデルを選択します。ここでのモデルとは、超解像のエンジン・アルゴリズム・種類のようなものを指します。

waifu2xのモデルは基本的に画像を対象としています。動画も要望があったので使えるようにしていますが、今のところ動画用には最適化されていません。

#### イラスト

最新の Art モデルです(`swin_unet/art`)。

イラストを対象としてPSNRを最適化しています。超解像でのPSNRとは、一度縮小した画像を超解像で拡大して元画像とピクセルレベルで差が小さいほどよいとする指標です。
拡大以外の余計なことをしないモデルです。

#### イラスト/スキャン

最新の Art/Scan モデルです(`swin_unet/art_scan`)。

漫画や雑誌等の印刷物からのスキャンや撮影されたアニメなど生のデジタルデータではないイラストを対象としたモデルです。通常のデジタルイラストに使うとくっきりした結果になるのでこちらが好みの場合は通常使用もできます。

学習にGANを使用しているモデルです。GANで学習されたモデルは入力画像以外の知識を多く使って結果を生成します。何か改変を行う可能性があります。

#### 写真

最新の Photo モデルです(`swin_unet/photo`)。

写真・実写用です。

学習にGANを使用しています。

#### `cunet/art`

1世代前の Art モデルです(`cunet/art`)。`waifu2x-caffe`や`waifu2x-ncnn-vulkan`などサードパーティ製ソフトウェアで使われているのと同じモデルです。
PSNR最適化モデルです。

処理速度と品質のバランスがよいモデルです。

#### `upconv_7/art`, `upconv_7/photo`

2世代前の Art モデル(`upconv_7/art`)と Photo モデル(`upconv_7/photo`)です。
PSNR最適化モデルです。

品質は最新からするとよくないですが、非常に速いです。

### 拡大

拡大率を指定します。

`2x`が`200%`、`4x`が`400%`です。`なし`は、拡大せずノイズ除去のみを行います。
`4x`は一部のモデルしか対応していません。

### ノイズ除去

ノイズ除去の強さを指定します。

`イラスト`ではJPEG圧縮ノイズのみを想定しています。
`イラスト/スキャン`,`写真`では、カメラや印刷・紙に関連する様々なノイズに対応しています。

## プロセッサ

計算に関連する設定です。

### デバイス

計算に使用するGPUまたはCPUを指定します。

GPUにはCUDAに対応しているグラフィックボードが表示されます。事実上NVIDIA製になります。
`All CUDA Device`を選択すると使用できるGPUをすべて使用します。

CPUでも動作はしますが、信じがたい遅さになります。

### 分割サイズ

waifu2xは内部的に画像をタイルに分割して処理しています。そのサイズ(px)を指定します。

学習にGANを使っているモデルでは大きい値ほどタイルの境界が目立ちにくくなります。

以下のバッチサイズとも関連しています。処理速度のチューニングでは、分割サイズは256に固定してバッチサイズのほうを調節するのがオススメです。

### バッチサイズ

分割したタイルを同時に処理する数です。
通常は大きい値ほど多くのVRAM(グラフィックボードのメモリ)を使用して処理が速くなります。環境によっては小さい値のほうが速いこともあります。

VRAMが少ないGPUでは小さい値にしないとメモリ不足エラーになります。分割サイズが大きい場合も小さい値にしないとメモリ不足エラーになります。

### TTA

waifu2xの結果は画像を左右上下反転したときに若干結異なります。
TTAでは、8パターンの反転結果を平均することで品質を改善します。ただし処理時間が8倍になります。

学習にGANを使っているモデルでは、この設定は無視されます。

### FP16

計算に半精度浮動小数点(16bit float)を使用します。
Turing(RTX20シリーズ)以降のGPUでは有効にすることで処理が速くなりVRAMの使用量が減ります。OFFにする理由はありません。

古いGPUでは遅くなったりエラーになったりするかもしれません。その場合はOFFにできます。

## 動画圧縮

動画出力時の設定です。主にlibx264の設定です。
より詳しい情報は https://trac.ffmpeg.org/wiki/Encode/H.264 を参照してください。

### 最大フレームレート

動画のフレームレート(一秒間のフレーム数)が最大フレームレートを超えているときは最大フレームレートに制限します。
超えていないときはオリジナルの（平均）フレームレートで出力します。

デフォルトで30FPSに制限されていることに注意してください。

### ピクセルフォーマット

画素のフォーマットです。

yuv420pは動画で使用されるもっとも一般的なフォーマットです。
ただし、クロマサブサンプリングという色情報の圧縮を行うので色が劣化します。
waifu2xのノイズ除去は、クロマサブサンプリングによる色の劣化を復元しますが、出力時にyuv420pを使うとまた劣化させて保存してしまいます。

yuv444pはクロマサブサンプリングを行わない色が劣化しにくいフォーマットです。その分出力ファイルサイズが大きくなります。また動画投稿サイトなどで対応していないことがあります。

### CRF

品質設定です。**小さい値**ほど品質が高くファイルサイズが大きくなります。

### プリセット

処理速度と圧縮率のバランスを決めるオプションです。
遅い設定のほうが圧縮率が高くファイルサイズが小さくなります。

### チューニング

入力にあった設定のセットを使用できます。

- `animation`: アニメ
- `film`: 映画 実写
- `stillimage`: スライドショー
- `grain`: アナログフィルム (粒子状ノイズの維持）
- `fastdecode`: いくつかのフィルタを無効にすることで再生時の負荷を減らします
- `zerolatency`: シークが速くなります。

よくわからない場合は選択しません。

## ビデオフィルタ

動画の前処理です。

### 開始時間, 終了時間

入力動画内の処理する時間範囲を指定します。指定された時間範囲のみ出力します。
チェックを付けなければすべて処理されます。

### デインターレース

入力ストリームに対してデインターレースフィルタを適用します。インターレース方式の動画に使用します。
（動画に細かい横線が点滅するやつを消します）

現在は、yadifが選択できます。
他のフィルタやより高度なオプションを使いたい場合は下記のvfオプションを使用してください。

## 回転

入力フレームを90°回転させます。スマホで撮影した動画など横向きになっている動画を処理前に修正する機能です。

## vf

入力動画ストリームに対してffmpegのビデオフィルター(-vfオプション)を適用します。この処理は超解像よりも前に適用されます。

ブランチを含む複雑な式は動作しません。`フィルタ名1,フィルタ名2=パラメータ1:パラメータ2,...`形式の直列な式のみ対応しています。パラメータ内の`,`は`\,`にエスケープしてください。
式の解析が独自実装なのでうまくいかない式があるかもしれません。

## 開始・キャンセル

`開始`ボタンで処理を開始します。`キャンセル`ボタンで実行中の処理をキャンセルします。
